# Shell and terminal settings
set-option -g default-shell /usr/bin/fish
set-option -sa terminal-overrides ',alacritty:RGB'

# Mouse support and indexing
set -g mouse on
set -g base-index 1

is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
is_fzf="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?fzf$'"
is_vim_or_fzf="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?(g?(view|n?vim?x?)(diff)?|fzf)$'"

# Session control
bind-key -n C-z   if-shell "$is_vim_or_fzf" "send-keys C-z"    "detach"
bind-key    C-z                                                "detach"
bind-key -n C-S-q                                              "kill-session"
# C-b d - Detach from session
# C-b w - Session,window list
# C-b ( - Previous session
# C-b ) - Next session

# Tab management (called windows in tmux)
bind-key -n C-t   if-shell "$is_vim"        "send-keys C-t"    "new-window"
bind-key    C-t                                                "new-window"
bind-key -n C-q   if-shell "$is_vim"        "send-keys C-q"    "kill-window"
bind-key    C-q                                                "kill-window"
bind-key -n C-n   if-shell "$is_vim"        "send-keys C-n"    "previous-window"
bind-key    C-n                                                "previous-window"
bind-key -n C-p   if-shell "$is_vim"        "send-keys C-p"    "next-window"
bind-key    C-p                                                "next-window"
# Standard keybindings
# C-b c - New window
# C-b & - Kill window
# C-b p - Previous window
# C-b n - Next window

# Window management (called panes in tmux)
bind-key -n C-s   if-shell "$is_vim"        "send-keys C-s"    "split-window -v"
bind-key    C-s                                                "split-window -v"
bind-key -n C-v   if-shell "$is_vim"        "send-keys C-v"    "split-window -h"
bind-key    C-v                                                "split-window -h"
bind-key -n C-h  if-shell  "$is_vim"        "send-keys C-h"    "select-pane -L"
bind-key    C-h                                                "select-pane -L"
bind-key -n C-j  if-shell  "$is_vim"        "send-keys C-j"    "select-pane -D"
bind-key    C-j                                                "select-pane -D"
bind-key -n C-k  if-shell  "$is_vim"        "send-keys C-k"    "select-pane -U"
bind-key    C-k                                                "select-pane -U"
bind-key -n C-l  if-shell  "$is_vim"        "send-keys C-l"    "select-pane -R"
bind-key    C-l                                                "select-pane -R"
bind-key -n C-\  if-shell  "$is_vim"        "send-keys C-\\"   "select-pane -l"
bind-key    C-\                                                "select-pane -l"
bind-key -n C-d  if-shell  "$is_vim"        "send-keys C-d"    "kill-pane"
bind-key    C-d                                                "kill-pane"
# Standard keybindings
# C-b " - Split window vertical
# C-b % - Split window horizontal
# C-b left - Select pane
# C-b down - Select pane
# C-b up - Select pane
# C-b right - Select pane

# Window title handling
# set-window-option -g automatic-rename on
# set-option -g set-titles on
